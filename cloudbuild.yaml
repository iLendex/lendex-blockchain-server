
options:
  logging: CLOUD_LOGGING_ONLY
  
steps:
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
      - 'compute'
      - 'ssh'
      - 'lendex-small'
      - '--zone=us-east1-b'
      - '--command=cd /app && git pull && npm install && pm2 restart all'
      - |
        echo "ETHEREUM_RPC_URL=$(gcloud secrets versions access latest --secret=ETHEREUM_RPC_URL)" >> .env
        echo "ETHEREUM_PRIVATE_KEY=$(gcloud secrets versions access latest --secret=ETHEREUM_PRIVATE_KEY)" >> .env
        echo "LENDEX_CONTRACT_ADDRESS=$(gcloud secrets versions access latest --secret=LENDEX_CONTRACT_ADDRESS)" >> .env
        echo "BLOCKFROST_PREPROD_API_KEY=$(gcloud secrets versions access latest --secret=BLOCKFROST_PREPROD_API_KEY)" >> .env
        echo "CHAINLINK_SOURCE_HASH=$(gcloud secrets versions access latest --secret=CHAINLINK_SOURCE_HASH)" >> .env
        echo "CHAINLINK_CONSUMER_ADDRESS=$(gcloud secrets versions access latest --secret=CHAINLINK_CONSUMER_ADDRESS)" >> .env
        echo "PROVIDER_RPC_URL=$(gcloud secrets versions access latest --secret=PROVIDER_RPC_URL)" >> .env
        echo "PROVIDER_API_KEY=$(gcloud secrets versions access latest --secret=PROVIDER_API_KEY)" >> .env
        echo "CHAINLINK_TOKEN_ADDRESS=$(gcloud secrets versions access latest --secret=CHAINLINK_TOKEN_ADDRESS)" >> .env
        echo "CHAINLINK_FUNCTIONS_ROUTER=$(gcloud secrets versions access latest --secret=CHAINLINK_FUNCTIONS_ROUTER)" >> .env
        echo "CHAINLINK_SUBSCRIPTION_ID=$(gcloud secrets versions access latest --secret=CHAINLINK_SUBSCRIPTION_ID)" >> .env
        echo "CHAINLINK_DON_ID=$(gcloud secrets versions access latest --secret=CHAINLINK_DON_ID)" >> .env
        echo "CHAINLINK_ENCRYPTED_SECRETS_UPLOAD_ENDPOINTS=$(gcloud secrets versions access latest --secret=CHAINLINK_ENCRYPTED_SECRETS_UPLOAD_ENDPOINTS)" >> .env
        echo "ETHERSCAN_PREPROD_API_KEY=$(gcloud secrets versions access latest --secret=ETHERSCAN_PREPROD_API_KEY)" >> .env
        echo "NETWORK=$(gcloud secrets versions access latest --secret=NETWORK)" >> .env